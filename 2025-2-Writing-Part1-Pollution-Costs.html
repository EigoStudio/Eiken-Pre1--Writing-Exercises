<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>2025-2 è‹±æ¤œæº–1ç´š ä½œæ–‡ ä¸¦ã¹æ›¿ãˆå•é¡Œ Part1</title>
    <link href="https://fonts.googleapis.com/css2?family=Kosugi+Maru&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Kosugi Maru', "Hiragino Maru Gothic ProN", sans-serif;
            background-color: #e0f2f1;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            padding-bottom: 100px;
            color: #004d40;
            margin: 0;
            /* ãƒ‰ãƒ©ãƒƒã‚°ä¸­ã«ç”»é¢ãŒã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã—ã¦ã—ã¾ã‚ãªã„ã‚ˆã†ã«åˆ¶é™ï¼ˆå¿…è¦ãªå ´åˆã®ã¿ï¼‰ */
            touch-action: pan-y;
        }

        h2 { color: #00695c; margin-bottom: 5px; }
        .sub-title { font-size: 0.9rem; color: #00796b; margin-bottom: 20px; text-align: center; line-height: 1.4; }

        .container {
            background: white;
            max-width: 800px;
            width: 100%;
            padding: 25px;
            border-radius: 20px;
            box-shadow: 0 8px 20px rgba(0, 77, 64, 0.15);
            text-align: center;
            box-sizing: border-box;
        }

        .question-box {
            font-size: 1.1rem;
            font-weight: bold;
            margin-bottom: 20px;
            min-height: 60px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            background-color: #e8f5e9;
            border-radius: 15px;
            padding: 15px;
            border-left: 8px solid #4caf50;
            color: #1b5e20;
            text-align: left;
        }

        .answer-area {
            min-height: 80px;
            border: 2px dashed #80cbc4;
            margin-bottom: 20px;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 8px;
            padding: 15px;
            background-color: #fafafa;
            border-radius: 10px;
            position: relative;
        }

        .word-bank { display: flex; flex-wrap: wrap; justify-content: center; gap: 10px; margin-bottom: 20px; }

        .word-btn {
            background-color: #b2dfdb; 
            color: #004d40;           
            border: 2px solid #80cbc4;
            padding: 10px 16px;
            border-radius: 25px;
            font-size: 0.95rem;
            cursor: pointer;
            box-shadow: 0 3px 0 #80cbc4;
            font-weight: bold;
        }
        .word-btn.used { background-color: #e0e0e0; color: #bdbdbd; border-color: #d7d7d7; box-shadow: none; pointer-events: none; }

        .answer-word {
            background-color: #ffb300;
            color: #004d40;
            border: none;
            padding: 10px 16px;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: bold;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            user-select: none;
            /* æŒ‡ã§ã®æ“ä½œã‚’ã‚¹ãƒ ãƒ¼ã‚ºã«ã™ã‚‹è¨­å®š */
            touch-action: none; 
            cursor: move;
        }

        /* ãƒ‰ãƒ©ãƒƒã‚°ä¸­ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .dragging {
            opacity: 0.5;
            transform: scale(1.05);
        }

        .fab-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            display: flex;
            gap: 15px;
            z-index: 1000;
        }
        .fab {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: none;
            background-color: #ffb300;
            color: #004d40;
            font-size: 1.5rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }

        .result-msg { font-weight: bold; font-size: 1.2rem; min-height: 35px; margin-bottom: 10px; }

        .final-sentence { font-size: 1.3rem; color: #004d40; font-weight: bold; padding: 20px; line-height: 1.6; }

        @media print {
            .no-print { display: none !important; }
            #printable-sheet { display: block !important; }
        }
        #printable-sheet { display: none; }
    </style>
</head>
<body>

<div class="no-print" style="text-align: center;">
    <h2>2025-2 è‹±æ¤œæº–1ç´š ä½œæ–‡ ä¸¦ã¹æ›¿ãˆå•é¡Œ Part1</h2>
    <div class="sub-title">Topic: Public Transportation Requirement<br><b>Focus: Pollution & Costs</b></div>
</div>

<div class="container no-print">
    <div id="game-ui">
        <div id="questionHeader" style="font-weight: bold; margin-bottom: 10px; color: #00796b;"></div>
        <div class="question-box" id="questionText"></div>
        <div class="result-msg" id="resultMsg"></div>
        <div class="answer-area" id="answerArea"></div>
        <div class="word-bank" id="wordBank"></div>
        <div style="margin-top: 20px; display: flex; justify-content: center; gap: 15px;">
            <button class="word-btn" id="checkBtn" onclick="checkAnswer()" style="background-color: #004d40; color: white; width: 180px; box-shadow: 0 3px 0 #002d20;">Check Answer</button>
            <button class="word-btn" id="nextBtn" onclick="nextQuestion()" style="display:none; background-color: #2e7d32; color: white; width: 180px; box-shadow: 0 3px 0 #1b5e20;">Next Question</button>
        </div>
    </div>
</div>

<div class="fab-container no-print">
    <button class="fab" id="ttsBtn" onclick="speakPhrase()" title="èª­ã¿ä¸Šã’" style="display:none;">ğŸ”Š</button>
    <button class="fab" onclick="window.print()" title="å°åˆ·">ğŸ–¨ï¸</button>
</div>

<script>
let quizDataOriginal = [
    { ja: "[Pollution] å…¬å…±äº¤é€šæ©Ÿé–¢ã®åˆ©ç”¨ã‚’ç¾©å‹™ä»˜ã‘ã‚‹ã“ã¨ã¯ã€éƒ½å¸‚éƒ¨ã®å…¨ä½“çš„ãªç‚­ç´ è¶³è·¡ã‚’åŠ‡çš„ã«å‰Šæ¸›ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ã€‚", en: "Mandating public transport usage could drastically reduce the overall carbon footprint of metropolitan areas." },
    { ja: "[Pollution] éƒ½å¸‚ä¸­å¿ƒéƒ¨ã®ç©ºæ°—ã®è³ªã‚’æ”¹å–„ã™ã‚‹ã“ã¨ã¯ã€å…¬è¡†è¡›ç”Ÿæ”¯å‡ºã®é•·æœŸçš„ãªç¯€ç´„ã«ç›´çµã™ã‚‹ã€‚", en: "Improving air quality in city centers directly leads to long-term savings in public healthcare expenditures." },
    { ja: "[Pollution] æŒç¶šå¯èƒ½ãªé€šå‹¤ã«å‘ã‘ãŸç¤¾ä¼šå…¨ä½“ã§ã®å–ã‚Šçµ„ã¿ã¯ã€åŠ é€Ÿã™ã‚‹åœ°çƒæ¸©æš–åŒ–ã®å½±éŸ¿ã‚’ç·©å’Œã™ã‚‹ãŸã‚ã«ä¸å¯æ¬ ã§ã‚ã‚‹ã€‚", en: "Collective action toward sustainable commuting is essential to mitigate the accelerating effects of global warming." },
    { ja: "[Pollution] è‡ªå®¶ç”¨è»Šã‹ã‚‰é›»æ°—ãƒã‚¹ã¸ã®ç§»è¡Œã¯ã€ã‚ˆã‚Šç’°å¢ƒæ„è­˜ã®é«˜ã„éƒ½å¸‚ã‚¤ãƒ³ãƒ•ãƒ©ã‚’ä¿ƒé€²ã™ã‚‹ã€‚", en: "Transitioning from private cars to electric buses promotes a more environmentally conscious urban infrastructure." },
    { ja: "[Pollution] äº¤é€šæ¸‹æ»ã®ç·©å’Œã¯ã€äººå£å¯†é›†åœ°ã«ãŠã‘ã‚‹çª’ç´ é…¸åŒ–ç‰©ã®æ’å‡ºã‚’å¤§å¹…ã«æ¸›å°‘ã•ã›ã‚‹ã€‚", en: "The reduction of traffic congestion significantly lowers the emission of nitrogen oxides in densely populated zones." },
    { ja: "[Costs] åŒ…æ‹¬çš„ãªäº¤é€šã‚·ã‚¹ãƒ†ãƒ ã¸ã®æŠ•è³‡ã¯ã€åŠ´åƒåŠ›ã®æµå‹•æ€§ã‚’é«˜ã‚ã‚‹ã“ã¨ã§åœ°åŸŸçµŒæ¸ˆã‚’æ´»æ€§åŒ–ã•ã›ã‚‹ã€‚", en: "Investing in comprehensive transit systems stimulates local economies by enhancing the mobility of the workforce." },
    { ja: "[Costs] åºƒå¤§ãªé“è·¯ç¶²ã®ç¶­æŒã¯ã€åœ°æ–¹è‡ªæ²»ä½“ã®ç´ç¨è€…ã«é‡ã„è²¡æ”¿çš„è² æ‹…ã‚’å¼·ã„ã‚‹ã€‚", en: "The maintenance of extensive road networks imposes a heavy financial burden on municipal taxpayers." },
    { ja: "[Costs] å…¬å…±äº¤é€šæ©Ÿé–¢ã¸ã®åŠ©æˆã¯ã€è‡ªå®¶ç”¨è»Šã«å¯¾å¿œã™ã‚‹ãŸã‚ã«é«˜é€Ÿé“è·¯ã‚’æ‹¡å¼µã™ã‚‹ã‚ˆã‚Šã‚‚è²»ç”¨å¯¾åŠ¹æœãŒé«˜ã„å ´åˆãŒã‚ã‚‹ã€‚", en: "Subsidizing public transportation can be more cost-effective than expanding highways to accommodate private vehicles." },
    { ja: "[Costs] è¼¸å…¥åŒ–çŸ³ç‡ƒæ–™ã¸ã®ä¾å­˜ã‚’æ¸›ã‚‰ã™ã“ã¨ã¯ã€å›½å®¶ã®çµŒæ¸ˆçš„å®‰å®šã¨ã‚¨ãƒãƒ«ã‚®ãƒ¼å®‰å…¨ä¿éšœã‚’å¼·åŒ–ã™ã‚‹ã€‚", en: "Reducing dependence on imported fossil fuels enhances the economic stability and energy security of the nation." },
    { ja: "[Costs] åŠ¹ç‡çš„ãªäº¤é€šç¶²ã¯ã€ä¸å‹•ç”£ä¾¡å€¤ã‚’é«˜ã‚ã€æœªé–‹ç™ºã®éƒ½å¸‚åœ°åŒºã¸ã®å•†æ¥­æŠ•è³‡ã‚’å‘¼ã³è¾¼ã‚€ã€‚", en: "Efficient transit networks increase property values and attract commercial investments to underdeveloped urban districts." }
];

let quizData = [...quizDataOriginal];
let currentIdx = 0;
let userSelection = [];
let isCorrect = false;

function init() {
    renderQuestion();
}

function shuffle(array) {
    for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
    }
    return array;
}

function renderQuestion() {
    isCorrect = false;
    userSelection = [];
    document.getElementById('ttsBtn').style.display = 'none';
    document.getElementById('nextBtn').style.display = 'none';
    document.getElementById('checkBtn').style.display = 'block';
    document.getElementById('resultMsg').textContent = "";
    document.getElementById('questionHeader').textContent = `Question ${currentIdx + 1} / ${quizData.length}`;
    const q = quizData[currentIdx];
    document.getElementById('questionText').innerHTML = q.ja;

    let words = q.en.replace(/([.,])/g, " $1").split(/\s+/).filter(w => w.length > 0);
    let shuffled = shuffle([...words]);

    const bank = document.getElementById('wordBank');
    bank.innerHTML = "";
    shuffled.forEach((w, i) => {
        const btn = document.createElement('button');
        btn.className = "word-btn";
        btn.textContent = w;
        btn.onclick = () => addWord(w, btn);
        bank.appendChild(btn);
    });
    renderAnswer();
}

function addWord(word, btn) {
    userSelection.push({ text: word, btn: btn });
    btn.classList.add('used');
    renderAnswer();
}

function renderAnswer() {
    const area = document.getElementById('answerArea');
    area.innerHTML = "";
    if (userSelection.length === 0 && !isCorrect) {
        area.innerHTML = '<span style="color:#aaa; font-size:0.85rem;">ã‚¿ãƒƒãƒ—ã§è¿½åŠ  / æŒ‡ã§å¼•ã£ã±ã£ã¦ä¸¦ã¹æ›¿ãˆ</span>';
    }

    userSelection.forEach((obj, i) => {
        const btn = document.createElement('button');
        btn.className = "answer-word";
        btn.textContent = obj.text;
        
        // --- ã‚¹ãƒãƒ›ï¼†PCå¯¾å¿œãƒ‰ãƒ©ãƒƒã‚°ãƒ­ã‚¸ãƒƒã‚¯ ---
        
        // PCç”¨ï¼ˆMouse Eventsï¼‰
        btn.draggable = true;
        btn.ondragstart = (e) => {
            e.dataTransfer.setData("text/plain", i);
            btn.classList.add('dragging');
        };
        btn.ondragend = () => btn.classList.remove('dragging');
        
        // PCç”¨ï¼ˆDropï¼‰
        btn.ondragover = (e) => e.preventDefault();
        btn.ondrop = (e) => {
            e.preventDefault();
            const fromIdx = e.dataTransfer.getData("text/plain");
            moveItem(parseInt(fromIdx), i);
        };

        // ã‚¹ãƒãƒ›ç”¨ï¼ˆTouch Eventsï¼‰
        btn.ontouchstart = (e) => {
            btn.classList.add('dragging');
            btn.dataset.index = i;
        };

        btn.ontouchend = (e) => {
            btn.classList.remove('dragging');
            const touch = e.changedTouches[0];
            const targetEl = document.elementFromPoint(touch.clientX, touch.clientY);
            
            if (targetEl && targetEl.classList.contains('answer-word')) {
                // ä»–ã®å˜èªã®ä¸Šã«ãƒ‰ãƒ­ãƒƒãƒ—ã•ã‚ŒãŸå ´åˆ
                const targetIdx = Array.from(area.children).indexOf(targetEl);
                moveItem(i, targetIdx);
            } else if (!targetEl || !targetEl.closest('.answer-area')) {
                // ã‚¨ãƒªã‚¢å¤–ã«æ”¾ã‚Šå‡ºã•ã‚ŒãŸã‚‰å‰Šé™¤
                removeWord(i);
            }
        };

        area.appendChild(btn);
    });
}

function moveItem(from, to) {
    const item = userSelection.splice(from, 1)[0];
    userSelection.splice(to, 0, item);
    renderAnswer();
}

function removeWord(i) {
    userSelection[i].btn.classList.remove('used');
    userSelection.splice(i, 1);
    renderAnswer();
}

function checkAnswer() {
    const userStr = userSelection.map(o => o.text).join(" ").replace(/\s+([.,])/g, "$1");
    const q = quizData[currentIdx];
    if (userStr === q.en) {
        isCorrect = true;
        document.getElementById('resultMsg').innerHTML = "<span style='color:#2e7d32;'>Excellent! æ­£è§£ã§ã™ï¼</span>";
        document.getElementById('answerArea').innerHTML = `<div class="final-sentence" id="orderPhrase">${userStr}</div>`;
        document.getElementById('wordBank').innerHTML = "";
        document.getElementById('ttsBtn').style.display = 'flex';
        document.getElementById('checkBtn').style.display = 'none';
        document.getElementById('nextBtn').style.display = 'block';
    } else {
        document.getElementById('resultMsg').innerHTML = "<span style='color:#c62828;'>æƒœã—ã„ï¼ã‚‚ã†ä¸€åº¦ä¸¦ã¹æ›¿ãˆã¦ã¿ã‚ˆã†ã€‚</span>";
    }
}

// éŸ³å£°èª­ã¿ä¸Šã’ï¼ˆSamantha/Googleå„ªå…ˆï¼‰
function speak(text) {
    const synth = window.speechSynthesis;
    synth.cancel(); 
    const uttr = new SpeechSynthesisUtterance(text);
    uttr.lang = "en-US";
    uttr.rate = 0.8; 
    uttr.pitch = 1.1; 
    const voices = synth.getVoices();
    const targetVoice = voices.find(v => v.name.includes('Samantha')) || 
                        voices.find(v => v.name.includes('Google US English')) || 
                        voices.find(v => v.lang === 'en-US');
    if (targetVoice) uttr.voice = targetVoice;
    synth.speak(uttr);
}

function speakPhrase() {
    speak(document.getElementById('orderPhrase').innerText);
}

function nextQuestion() {
    currentIdx++;
    if (currentIdx < quizData.length) renderQuestion();
    else document.getElementById('game-ui').innerHTML = "<h2>ğŸ‰ Part 1 ã‚¯ãƒªã‚¢ï¼</h2>";
}

window.speechSynthesis.onvoiceschanged = () => {};
init();
</script>
</body>
</html>
