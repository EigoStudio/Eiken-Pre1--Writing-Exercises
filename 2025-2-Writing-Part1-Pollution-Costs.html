<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>è‹±æ¤œæº–1ç´š ä½œæ–‡ ä¸¦ã¹æ›¿ãˆ Part1</title>
    <link href="https://fonts.googleapis.com/css2?family=Kosugi+Maru&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Kosugi Maru', sans-serif;
            background-color: #e0f2f1;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px; /* ä½™ç™½ã‚’æœ€å°é™ã« */
            padding-bottom: 80px;
            color: #004d40;
            margin: 0;
            overflow-x: hidden;
            touch-action: pan-y;
        }

        h2 { color: #00695c; margin-top: 10px; margin-bottom: 5px; font-size: 1.4rem; }
        .sub-title { font-size: 0.8rem; color: #00796b; margin-bottom: 15px; text-align: center; }

        .container {
            background: white;
            width: 100%; /* æ¨ªå¹…ã„ã£ã±ã„ */
            max-width: 800px;
            padding: 15px; /* ã‚³ãƒ³ãƒ†ãƒŠå†…ã‚‚å°‘ã—çµã‚‹ */
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0, 77, 64, 0.1);
            text-align: center;
            box-sizing: border-box;
        }

        .question-box {
            font-size: 1rem;
            font-weight: bold;
            margin-bottom: 15px;
            background-color: #e8f5e9;
            border-radius: 12px;
            padding: 12px;
            border-left: 6px solid #4caf50;
            text-align: left;
            line-height: 1.4;
        }

        .answer-area {
            min-height: 90px;
            border: 2px dashed #80cbc4;
            margin-bottom: 15px;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 6px; /* å˜èªåŒå£«ã®éš™é–“ã‚’è©°ã‚ã‚‹ */
            padding: 10px;
            background-color: #fafafa;
            border-radius: 10px;
        }

        .word-bank { 
            display: flex; 
            flex-wrap: wrap; 
            justify-content: center; 
            gap: 8px; 
            margin-bottom: 15px;
        }

        .word-btn {
            background-color: #b2dfdb; 
            color: #004d40;           
            border: 1px solid #80cbc4;
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: bold;
            box-shadow: 0 2px 0 #80cbc4;
        }
        .word-btn.used { background-color: #e0e0e0; color: #bdbdbd; border-color: #d7d7d7; box-shadow: none; }

        .answer-word {
            background-color: #ffb300;
            color: #004d40;
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 0.95rem;
            font-weight: bold;
            box-shadow: 0 2px 4px rgba(0,0,0,0.15);
            user-select: none;
            touch-action: none;
            cursor: move;
        }

        .dragging { opacity: 0.5; transform: scale(1.05); z-index: 1000; }

        /* å°åˆ·ãƒœã‚¿ãƒ³ã¯ã‚¹ãƒãƒ›ã§ã¯ç›®ç«‹ãŸãªã„ä½ç½®ã€ã¾ãŸã¯ãƒ•ãƒƒã‚¿ãƒ¼ã¸ */
        .footer-tools {
            margin-top: 20px;
            display: flex;
            gap: 10px;
            justify-content: center;
        }

        .fab-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 2000;
        }

        /* èª­ã¿ä¸Šã’ãƒœã‚¿ãƒ³ã ã‘ã‚’ãƒ¡ã‚¤ãƒ³ã®FABã« */
        .fab {
            width: 55px;
            height: 55px;
            border-radius: 50%;
            border: none;
            background-color: #ffb300;
            color: #004d40;
            font-size: 1.4rem;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }

        .result-msg { font-weight: bold; margin-bottom: 8px; min-height: 24px; font-size: 0.9rem; }
        .final-sentence { font-size: 1.2rem; font-weight: bold; padding: 15px; line-height: 1.5; color: #004d40; }

        /* å°åˆ·ç”¨ã¯ä»Šã¾ã§é€šã‚Š */
        @media print {
            body { padding: 0; background: white; }
            .no-print { display: none !important; }
            #printable-sheet { display: block !important; }
        }
        #printable-sheet { display: none; }
    </style>
</head>
<body>

<div class="no-print">
    <h2>è‹±æ¤œæº–1ç´š ä½œæ–‡ ä¸¦ã¹æ›¿ãˆ Part1</h2>
    <div class="sub-title">Pollution & Costs</div>
</div>

<div class="container no-print">
    <div id="game-ui">
        <div id="questionHeader" style="font-weight: bold; margin-bottom: 8px; font-size: 0.9rem;"></div>
        <div class="question-box" id="questionText"></div>
        <div class="result-msg" id="resultMsg"></div>
        <div class="answer-area" id="answerArea"></div>
        <div class="word-bank" id="wordBank"></div>
        <div style="margin-top: 15px; display: flex; justify-content: center; gap: 10px;">
            <button class="word-btn" id="checkBtn" onclick="checkAnswer()" style="background-color: #004d40; color: white; min-width: 140px;">Check Answer</button>
            <button class="word-btn" id="nextBtn" onclick="nextQuestion()" style="display:none; background-color: #2e7d32; color: white; min-width: 140px;">Next Question</button>
        </div>
        
        <div class="footer-tools no-print">
            <button class="word-btn" onclick="window.print()" style="background-color: #607d8b; color: white; font-size: 0.7rem; padding: 5px 10px;">ğŸ–¨ï¸ å°åˆ·ç”¨ãƒšãƒ¼ã‚¸ã‚’è¡¨ç¤º</button>
        </div>
    </div>
</div>

<div class="fab-container no-print">
    <button class="fab" id="ttsBtn" onclick="speakPhrase()" style="display:none;">ğŸ”Š</button>
</div>

<script>
// (ä¸­ç•¥: JavaScriptãƒ­ã‚¸ãƒƒã‚¯ã¯ä»¥å‰ã® Pointer Logic ã‚’ç¶™ç¶šé©ç”¨)
let quizData = [
    { ja: "[Pollution] å…¬å…±äº¤é€šæ©Ÿé–¢ã®åˆ©ç”¨ã‚’ç¾©å‹™ä»˜ã‘ã‚‹ã“ã¨ã¯ã€éƒ½å¸‚éƒ¨ã®å…¨ä½“çš„ãªç‚­ç´ è¶³è·¡ã‚’åŠ‡çš„ã«å‰Šæ¸›ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ã€‚", en: "Mandating public transport usage could drastically reduce the overall carbon footprint of metropolitan areas." },
    { ja: "[Pollution] éƒ½å¸‚ä¸­å¿ƒéƒ¨ã®ç©ºæ°—ã®è³ªã‚’æ”¹å–„ã™ã‚‹ã“ã¨ã¯ã€å…¬è¡†è¡›ç”Ÿæ”¯å‡ºã®é•·æœŸçš„ãªç¯€ç´„ã«ç›´çµã™ã‚‹ã€‚", en: "Improving air quality in city centers directly leads to long-term savings in public healthcare expenditures." },
    { ja: "[Pollution] æŒç¶šå¯èƒ½ãªé€šå‹¤ã«å‘ã‘ãŸç¤¾ä¼šå…¨ä½“ã§ã®å–ã‚Šçµ„ã¿ã¯ã€åŠ é€Ÿã™ã‚‹åœ°çƒæ¸©æš–åŒ–ã®å½±éŸ¿ã‚’ç·©å’Œã™ã‚‹ãŸã‚ã«ä¸å¯æ¬ ã§ã‚ã‚‹ã€‚", en: "Collective action toward sustainable commuting is essential to mitigate the accelerating effects of global warming." },
    { ja: "[Pollution] è‡ªå®¶ç”¨è»Šã‹ã‚‰é›»æ°—ãƒã‚¹ã¸ã®ç§»è¡Œã¯ã€ã‚ˆã‚Šç’°å¢ƒæ„è­˜ã®é«˜ã„éƒ½å¸‚ã‚¤ãƒ³ãƒ•ãƒ©ã‚’ä¿ƒé€²ã™ã‚‹ã€‚", en: "Transitioning from private cars to electric buses promotes a more environmentally conscious urban infrastructure." },
    { ja: "[Pollution] äº¤é€šæ¸‹æ»ã®ç·©å’Œã¯ã€äººå£å¯†é›†åœ°ã«ãŠã‘ã‚‹çª’ç´ é…¸åŒ–ç‰©ã®æ’å‡ºã‚’å¤§å¹…ã«æ¸›å°‘ã•ã›ã‚‹ã€‚", en: "The reduction of traffic congestion significantly lowers the emission of nitrogen oxides in densely populated zones." },
    { ja: "[Costs] åŒ…æ‹¬çš„ãªäº¤é€šã‚·ã‚¹ãƒ†ãƒ ã¸ã®æŠ•è³‡ã¯ã€åŠ´åƒåŠ›ã®æµå‹•æ€§ã‚’é«˜ã‚ã‚‹ã“ã¨ã§åœ°åŸŸçµŒæ¸ˆã‚’æ´»æ€§åŒ–ã•ã›ã‚‹ã€‚", en: "Investing in comprehensive transit systems stimulates local economies by enhancing the mobility of the workforce." },
    { ja: "[Costs] åºƒå¤§ãªé“è·¯ç¶²ã®ç¶­æŒã¯ã€åœ°æ–¹è‡ªæ²»ä½“ã®ç´ç¨è€…ã«é‡ã„è²¡æ”¿çš„è² æ‹…ã‚’å¼·ã„ã‚‹ã€‚", en: "The maintenance of extensive road networks imposes a heavy financial burden on municipal taxpayers." },
    { ja: "[Costs] å…¬å…±äº¤é€šæ©Ÿé–¢ã¸ã®åŠ©æˆã¯ã€é«˜é€Ÿé“è·¯ã‚’æ‹¡å¼µã™ã‚‹ã‚ˆã‚Šã‚‚è²»ç”¨å¯¾åŠ¹æœãŒé«˜ã„å ´åˆãŒã‚ã‚‹ã€‚", en: "Subsidizing public transportation can be more cost-effective than expanding highways to accommodate private vehicles." },
    { ja: "[Costs] è¼¸å…¥åŒ–çŸ³ç‡ƒæ–™ã¸ã®ä¾å­˜ã‚’æ¸›ã‚‰ã™ã“ã¨ã¯ã€å›½å®¶ã®çµŒæ¸ˆçš„å®‰å®šã¨ã‚¨ãƒãƒ«ã‚®ãƒ¼å®‰å…¨ä¿éšœã‚’å¼·åŒ–ã™ã‚‹ã€‚", en: "Reducing dependence on imported fossil fuels enhances the economic stability and energy security of the nation." },
    { ja: "[Costs] åŠ¹ç‡çš„ãªäº¤é€šç¶²ã¯ã€ä¸å‹•ç”£ä¾¡å€¤ã‚’é«˜ã‚ã€æœªé–‹ç™ºã®éƒ½å¸‚åœ°åŒºã¸ã®å•†æ¥­æŠ•è³‡ã‚’å‘¼ã³è¾¼ã‚€ã€‚", en: "Efficient transit networks increase property values and attract commercial investments to underdeveloped urban districts." }
];

let currentIdx = 0;
let userSelection = [];
let dragItem = null;

function renderQuestion() {
    userSelection = [];
    document.getElementById('resultMsg').textContent = "";
    document.getElementById('nextBtn').style.display = "none";
    document.getElementById('checkBtn').style.display = "block";
    document.getElementById('ttsBtn').style.display = "none";
    document.getElementById('questionHeader').textContent = `Question ${currentIdx + 1} / ${quizData.length}`;
    document.getElementById('questionText').textContent = quizData[currentIdx].ja;

    let words = quizData[currentIdx].en.replace(/([.,])/g, " $1").split(/\s+/).filter(w => w.length > 0);
    const bank = document.getElementById('wordBank');
    bank.innerHTML = "";
    shuffle(words).forEach(w => {
        const btn = document.createElement('button');
        btn.className = "word-btn";
        btn.textContent = w;
        btn.onclick = () => {
            if (!btn.classList.contains('used')) {
                btn.classList.add('used');
                userSelection.push({ text: w, btn: btn });
                renderAnswer();
            }
        };
        bank.appendChild(btn);
    });
    renderAnswer();
}

function renderAnswer() {
    const area = document.getElementById('answerArea');
    area.innerHTML = userSelection.length === 0 ? '<span style="color:#aaa; font-size:0.75rem;">ã‚¿ãƒƒãƒ—ã§è¿½åŠ  / æˆ»ã™ãƒ»é•·æŠ¼ã—ã‚¹ãƒ©ã‚¤ãƒ‰ã§ä¸¦ã¹æ›¿ãˆ</span>' : "";

    userSelection.forEach((obj, i) => {
        const span = document.createElement('div');
        span.className = "answer-word";
        span.textContent = obj.text;
        
        let moved = false;
        span.onpointerdown = (e) => {
            moved = false;
            dragItem = i;
            span.classList.add('dragging');
            span.setPointerCapture(e.pointerId);
        };

        span.onpointermove = (e) => {
            if (dragItem === null) return;
            if (Math.abs(e.movementX) > 2 || Math.abs(e.movementY) > 2) moved = true;

            const target = document.elementFromPoint(e.clientX, e.clientY);
            if (target && target.classList.contains('answer-word')) {
                const targetIdx = Array.from(area.children).indexOf(target);
                if (targetIdx !== dragItem) {
                    const temp = userSelection.splice(dragItem, 1)[0];
                    userSelection.splice(targetIdx, 0, temp);
                    dragItem = targetIdx;
                    renderAnswer();
                }
            }
        };

        span.onpointerup = (e) => {
            span.classList.remove('dragging');
            const wasDragging = moved;
            dragItem = null;
            if (!wasDragging) {
                obj.btn.classList.remove('used');
                userSelection.splice(i, 1);
                renderAnswer();
            }
        };
        area.appendChild(span);
    });
}

function checkAnswer() {
    const userStr = userSelection.map(o => o.text).join(" ").replace(/\s+([.,])/g, "$1");
    if (userStr === quizData[currentIdx].en) {
        document.getElementById('resultMsg').innerHTML = "<span style='color:green;'>Excellent!</span>";
        document.getElementById('answerArea').innerHTML = `<div class="final-sentence" id="orderPhrase">${userStr}</div>`;
        document.getElementById('wordBank').innerHTML = "";
        document.getElementById('checkBtn').style.display = "none";
        document.getElementById('nextBtn').style.display = "block";
        document.getElementById('ttsBtn').style.display = "flex";
    } else {
        document.getElementById('resultMsg').innerHTML = "<span style='color:red;'>Try again!</span>";
    }
}

function nextQuestion() {
    currentIdx++;
    if (currentIdx < quizData.length) renderQuestion();
    else document.getElementById('game-ui').innerHTML = "<h2>ğŸ‰ Complete!</h2>";
}

function speakPhrase() {
    const uttr = new SpeechSynthesisUtterance(document.getElementById('orderPhrase').innerText);
    uttr.lang = "en-US";
    uttr.rate = 0.8;
    const voices = window.speechSynthesis.getVoices();
    uttr.voice = voices.find(v => v.name.includes('Samantha') || v.name.includes('Google US English')) || voices[0];
    window.speechSynthesis.speak(uttr);
}

function shuffle(array) {
    for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
    }
    return array;
}

window.speechSynthesis.onvoiceschanged = () => {};
renderQuestion();
</script>

</body>
</html>
