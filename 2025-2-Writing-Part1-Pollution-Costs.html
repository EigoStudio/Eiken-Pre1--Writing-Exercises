<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>2025-2 Ëã±Ê§úÊ∫ñ1Á¥ö ‰ΩúÊñá ‰∏¶„ÅπÊõø„Åà Part1</title>
    <link href="https://fonts.googleapis.com/css2?family=Kosugi+Maru&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Kosugi Maru', sans-serif;
            background-color: #e0f2f1;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px;
            padding-bottom: 100px;
            color: #004d40;
            margin: 0;
            overflow-x: hidden;
            touch-action: pan-y;
        }

        h2 { color: #00695c; margin-top: 15px; margin-bottom: 5px; font-size: 1.6rem; }
        .sub-title { font-size: 0.9rem; color: #00796b; margin-bottom: 20px; text-align: center; }

        .container {
            background: white;
            width: 100%;
            max-width: 900px;
            padding: 20px;
            border-radius: 20px;
            box-shadow: 0 8px 25px rgba(0, 77, 64, 0.1);
            text-align: center;
            box-sizing: border-box;
        }

        .question-box {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 20px;
            background-color: #e8f5e9;
            border-radius: 15px;
            padding: 18px;
            border-left: 8px solid #4caf50;
            text-align: left;
            line-height: 1.6;
        }

        .answer-area {
            min-height: 110px;
            border: 3px dashed #80cbc4;
            margin-bottom: 20px;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            padding: 15px;
            background-color: #fafafa;
            border-radius: 12px;
        }

        .word-bank { 
            display: flex; 
            flex-wrap: wrap; 
            justify-content: center; 
            gap: 12px; 
            margin-bottom: 20px;
        }

        .word-btn {
            background-color: #b2dfdb; 
            color: #004d40;           
            border: 2px solid #80cbc4;
            padding: 12px 20px;
            border-radius: 30px;
            font-size: 1.1rem;
            font-weight: bold;
            box-shadow: 0 4px 0 #80cbc4;
            cursor: pointer;
        }
        .word-btn.used { background-color: #e0e0e0; color: #bdbdbd; border-color: #d7d7d7; box-shadow: none; }

        .answer-word {
            background-color: #ffb300;
            color: #004d40;
            padding: 12px 20px;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: bold;
            box-shadow: 0 4px 6px rgba(0,0,0,0.15);
            user-select: none;
            touch-action: none;
            cursor: move;
        }

        /* „Éâ„É©„ÉÉ„Ç∞‰∏≠„ÅÆË¶ã„ÅüÁõÆÔºö„Çà„Çä„ÅØ„Å£„Åç„Çä„Å® */
        .dragging { opacity: 0.4; transform: scale(1.05); outline: 2px solid #004d40; z-index: 1000; }

        @media screen and (max-width: 600px) {
            h2 { font-size: 1.3rem; }
            .question-box { font-size: 1rem; padding: 12px; }
            .word-btn, .answer-word { font-size: 0.95rem; padding: 8px 14px; }
            .container { padding: 10px; }
            .answer-area { min-height: 90px; gap: 6px; }
        }

        .footer-tools { margin-top: 30px; display: flex; justify-content: center; }

        .fab-container { position: fixed; bottom: 30px; right: 30px; z-index: 2000; }
        .fab { width: 65px; height: 65px; border-radius: 50%; border: none; background-color: #ffb300; color: #004d40; font-size: 1.8rem; box-shadow: 0 6px 15px rgba(0,0,0,0.3); cursor: pointer; }

        .result-msg { font-weight: bold; margin-bottom: 15px; min-height: 30px; font-size: 1.2rem; }
        .final-sentence { font-size: 1.5rem; font-weight: bold; padding: 25px; line-height: 1.6; color: #004d40; }

        @media print { .no-print { display: none !important; } #printable-sheet { display: block !important; } }
        #printable-sheet { display: none; }
    </style>
</head>
<body>

<div class="no-print" style="text-align: center;">
    <h2>Ëã±Ê§úÊ∫ñ1Á¥ö ‰ΩúÊñá ‰∏¶„ÅπÊõø„Åà Part1</h2>
    <div class="sub-title">Pollution & Costs</div>
</div>

<div class="container no-print">
    <div id="game-ui">
        <div id="questionHeader" style="font-weight: bold; margin-bottom: 10px; font-size: 1rem;"></div>
        <div class="question-box" id="questionText"></div>
        <div class="result-msg" id="resultMsg"></div>
        <div class="answer-area" id="answerArea"></div>
        <div class="word-bank" id="wordBank"></div>
        <div style="margin-top: 20px; display: flex; justify-content: center; gap: 15px;">
            <button class="word-btn" id="checkBtn" onclick="checkAnswer()" style="background-color: #004d40; color: white; min-width: 200px; box-shadow: 0 4px 0 #002d20;">Check Answer</button>
            <button class="word-btn" id="nextBtn" onclick="nextQuestion()" style="display:none; background-color: #2e7d32; color: white; min-width: 200px; box-shadow: 0 4px 0 #1b5e20;">Next Question</button>
        </div>
        
        <div class="footer-tools no-print">
            <button class="word-btn" onclick="window.print()" style="background-color: #607d8b; color: white; font-size: 0.8rem; padding: 8px 15px; box-shadow: 0 3px 0 #455a64;">üñ®Ô∏è Âç∞Âà∑Áî®„Éö„Éº„Ç∏„ÇíË°®Á§∫</button>
        </div>
    </div>
</div>

<div class="fab-container no-print">
    <button class="fab" id="ttsBtn" onclick="speakPhrase()" style="display:none;">üîä</button>
</div>

<script>
let quizData = [
    { ja: "[Pollution] ÂÖ¨ÂÖ±‰∫§ÈÄöÊ©üÈñ¢„ÅÆÂà©Áî®„ÇíÁæ©Âãô‰ªò„Åë„Çã„Åì„Å®„ÅØ„ÄÅÈÉΩÂ∏ÇÈÉ®„ÅÆÂÖ®‰ΩìÁöÑ„Å™ÁÇ≠Á¥†Ë∂≥Ë∑°„ÇíÂäáÁöÑ„Å´ÂâäÊ∏õ„Åô„ÇãÂèØËÉΩÊÄß„Åå„ÅÇ„Çã„ÄÇ", en: "Mandating public transport usage could drastically reduce the overall carbon footprint of metropolitan areas." },
    { ja: "[Pollution] ÈÉΩÂ∏Ç‰∏≠ÂøÉÈÉ®„ÅÆÁ©∫Ê∞ó„ÅÆË≥™„ÇíÊîπÂñÑ„Åô„Çã„Åì„Å®„ÅØ„ÄÅÂÖ¨Ë°ÜË°õÁîüÊîØÂá∫„ÅÆÈï∑ÊúüÁöÑ„Å™ÁØÄÁ¥Ñ„Å´Áõ¥Áµê„Åô„Çã„ÄÇ", en: "Improving air quality in city centers directly leads to long-term savings in public healthcare expenditures." },
    { ja: "[Pollution] ÊåÅÁ∂öÂèØËÉΩ„Å™ÈÄöÂã§„Å´Âêë„Åë„ÅüÁ§æ‰ºöÂÖ®‰Ωì„Åß„ÅÆÂèñ„ÇäÁµÑ„Åø„ÅØ„ÄÅÂä†ÈÄü„Åô„ÇãÂú∞ÁêÉÊ∏©ÊöñÂåñ„ÅÆÂΩ±Èüø„ÇíÁ∑©Âíå„Åô„Çã„Åü„ÇÅ„Å´‰∏çÂèØÊ¨†„Åß„ÅÇ„Çã„ÄÇ", en: "Collective action toward sustainable commuting is essential to mitigate the accelerating effects of global warming." },
    { ja: "[Pollution] Ëá™ÂÆ∂Áî®Ëªä„Åã„ÇâÈõªÊ∞ó„Éê„Çπ„Å∏„ÅÆÁßªË°å„ÅØ„ÄÅ„Çà„ÇäÁí∞Â¢ÉÊÑèË≠ò„ÅÆÈ´ò„ÅÑÈÉΩÂ∏Ç„Ç§„É≥„Éï„É©„Çí‰øÉÈÄ≤„Åô„Çã„ÄÇ", en: "Transitioning from private cars to electric buses promotes a more environmentally conscious urban infrastructure." },
    { ja: "[Pollution] ‰∫§ÈÄöÊ∏ãÊªû„ÅÆÁ∑©Âíå„ÅØ„ÄÅ‰∫∫Âè£ÂØÜÈõÜÂú∞„Å´„Åä„Åë„ÇãÁ™íÁ¥†ÈÖ∏ÂåñÁâ©„ÅÆÊéíÂá∫„ÇíÂ§ßÂπÖ„Å´Ê∏õÂ∞ë„Åï„Åõ„Çã„ÄÇ", en: "The reduction of traffic congestion significantly lowers the emission of nitrogen oxides in densely populated zones." },
    { ja: "[Costs] ÂåÖÊã¨ÁöÑ„Å™‰∫§ÈÄö„Ç∑„Çπ„ÉÜ„É†„Å∏„ÅÆÊäïË≥á„ÅØ„ÄÅÂä¥ÂÉçÂäõ„ÅÆÊµÅÂãïÊÄß„ÇíÈ´ò„ÇÅ„Çã„Åì„Å®„ÅßÂú∞ÂüüÁµåÊ∏à„ÇíÊ¥ªÊÄßÂåñ„Åï„Åõ„Çã„ÄÇ", en: "Investing in comprehensive transit systems stimulates local economies by enhancing the mobility of the workforce." },
    { ja: "[Costs] Â∫ÉÂ§ß„Å™ÈÅìË∑ØÁ∂≤„ÅÆÁ∂≠ÊåÅ„ÅØ„ÄÅÂú∞ÊñπËá™Ê≤ª‰Ωì„ÅÆÁ¥çÁ®éËÄÖ„Å´Èáç„ÅÑË≤°ÊîøÁöÑË≤†ÊãÖ„ÇíÂº∑„ÅÑ„Çã„ÄÇ", en: "The maintenance of extensive road networks imposes a heavy financial burden on municipal taxpayers." },
    { ja: "[Costs] ÂÖ¨ÂÖ±‰∫§ÈÄöÊ©üÈñ¢„Å∏„ÅÆÂä©Êàê„ÅØ„ÄÅÈ´òÈÄüÈÅìË∑Ø„ÇíÊã°Âºµ„Åô„Çã„Çà„Çä„ÇÇË≤ªÁî®ÂØæÂäπÊûú„ÅåÈ´ò„ÅÑÂ†¥Âêà„Åå„ÅÇ„Çã„ÄÇ", en: "Subsidizing public transportation can be more cost-effective than expanding highways to accommodate private vehicles." },
    { ja: "[Costs] Ëº∏ÂÖ•ÂåñÁü≥ÁáÉÊñô„Å∏„ÅÆ‰æùÂ≠ò„ÇíÊ∏õ„Çâ„Åô„Åì„Å®„ÅØ„ÄÅÂõΩÂÆ∂„ÅÆÁµåÊ∏àÁöÑÂÆâÂÆö„Å®„Ç®„Éç„É´„ÇÆ„ÉºÂÆâÂÖ®‰øùÈöú„ÇíÂº∑Âåñ„Åô„Çã„ÄÇ", en: "Reducing dependence on imported fossil fuels enhances the economic stability and energy security of the nation." },
    { ja: "[Costs] ÂäπÁéáÁöÑ„Å™‰∫§ÈÄöÁ∂≤„ÅØ„ÄÅ‰∏çÂãïÁî£‰æ°ÂÄ§„ÇíÈ´ò„ÇÅ„ÄÅÊú™ÈñãÁô∫„ÅÆÈÉΩÂ∏ÇÂú∞Âå∫„Å∏„ÅÆÂïÜÊ•≠ÊäïË≥á„ÇíÂëº„Å≥Ëæº„ÇÄ„ÄÇ", en: "Efficient transit networks increase property values and attract commercial investments to underdeveloped urban districts." }
];

let currentIdx = 0;
let userSelection = [];
let dragItem = null;

function renderQuestion() {
    userSelection = [];
    document.getElementById('resultMsg').textContent = "";
    document.getElementById('nextBtn').style.display = "none";
    document.getElementById('checkBtn').style.display = "block";
    document.getElementById('ttsBtn').style.display = "none";
    document.getElementById('questionHeader').textContent = `Question ${currentIdx + 1} / ${quizData.length}`;
    document.getElementById('questionText').textContent = quizData[currentIdx].ja;

    let words = quizData[currentIdx].en.replace(/([.,])/g, " $1").split(/\s+/).filter(w => w.length > 0);
    const bank = document.getElementById('wordBank');
    bank.innerHTML = "";
    shuffle(words).forEach(w => {
        const btn = document.createElement('button');
        btn.className = "word-btn";
        btn.textContent = w;
        btn.onclick = () => {
            if (!btn.classList.contains('used')) {
                btn.classList.add('used');
                userSelection.push({ text: w, btn: btn });
                renderAnswer();
            }
        };
        bank.appendChild(btn);
    });
    renderAnswer();
}

function renderAnswer() {
    const area = document.getElementById('answerArea');
    area.innerHTML = userSelection.length === 0 ? '<span style="color:#aaa; font-size:0.9rem;">„Çø„ÉÉ„Éó„ÅßËøΩÂä† / ÈÖçÁΩÆÂæå„ÇÇ„Çø„ÉÉ„Éó„ÅßÊàª„Åô„ÉªÈï∑Êäº„Åó„Çπ„É©„Ç§„Éâ„Åß‰∏¶„ÅπÊõø„Åà</span>' : "";

    userSelection.forEach((obj, i) => {
        const span = document.createElement('div');
        span.className = "answer-word";
        span.textContent = obj.text;
        
        let moved = false;
        span.onpointerdown = (e) => {
            moved = false;
            dragItem = i; // „Åì„Åì„ÅßÂàù„ÇÅ„Å¶„ÄåÂÖ•„ÇåÊõø„ÅàÊ∫ñÂÇôOK„Äç„ÅÆ„Éï„É©„Ç∞„ÇíÁ´ã„Å¶„Çã
            span.classList.add('dragging');
            span.setPointerCapture(e.pointerId);
        };

        span.onpointermove = (e) => {
            if (dragItem === null) return; // „Éú„Çø„É≥„ÅåÊäº„Åï„Çå„Å¶„ÅÑ„Å™„ÅÑ„Éõ„Éê„ÉºÁä∂ÊÖã„Å™„Çâ‰Ωï„ÇÇ„Åó„Å™„ÅÑ
            
            // ÊÑèÂõ≥ÁöÑ„Å™„Éâ„É©„ÉÉ„Ç∞„Åã„Å©„ÅÜ„ÅãÂà§ÂÆöÔºàÂæÆÁ¥∞„Å™Âãï„Åç„ÅØ„Çø„ÉÉ„Éó„Å®„Åø„Å™„ÅôÔºâ
            if (Math.abs(e.movementX) > 1 || Math.abs(e.movementY) > 1) {
                moved = true;
            }

            if (moved) {
                const target = document.elementFromPoint(e.clientX, e.clientY);
                if (target && target.classList.contains('answer-word')) {
                    const targetIdx = Array.from(area.children).indexOf(target);
                    if (targetIdx !== dragItem) {
                        const temp = userSelection.splice(dragItem, 1)[0];
                        userSelection.splice(targetIdx, 0, temp);
                        dragItem = targetIdx;
                        renderAnswer();
                    }
                }
            }
        };

        span.onpointerup = (e) => {
            span.classList.remove('dragging');
            const wasDragging = moved;
            dragItem = null;
            
            // Âãï„Åã„Åï„Åö„Å´Êåá/„Éû„Ç¶„Çπ„ÇíÈõ¢„Åó„ÅüÂ†¥Âêà„ÅØ„ÄåÊàª„ÅôÔºàÂâäÈô§Ôºâ„Äç„ÇíÂÆüË°å
            if (!wasDragging) {
                obj.btn.classList.remove('used');
                userSelection.splice(i, 1);
                renderAnswer();
            }
        };
        area.appendChild(span);
    });
}

function checkAnswer() {
    const userStr = userSelection.map(o => o.text).join(" ").replace(/\s+([.,])/g, "$1");
    if (userStr === quizData[currentIdx].en) {
        document.getElementById('resultMsg').innerHTML = "<span style='color:green;'>Excellent!</span>";
        document.getElementById('answerArea').innerHTML = `<div class="final-sentence" id="orderPhrase">${userStr}</div>`;
        document.getElementById('wordBank').innerHTML = "";
        document.getElementById('checkBtn').style.display = "none";
        document.getElementById('nextBtn').style.display = "block";
        document.getElementById('ttsBtn').style.display = "flex";
    } else {
        document.getElementById('resultMsg').innerHTML = "<span style='color:red;'>Try again!</span>";
    }
}

function nextQuestion() {
    currentIdx++;
    if (currentIdx < quizData.length) renderQuestion();
    else document.getElementById('game-ui').innerHTML = "<h2 style='color:#00695c;'>üéâ Part 1 Complete!</h2>";
}

function speakPhrase() {
    const uttr = new SpeechSynthesisUtterance(document.getElementById('orderPhrase').innerText);
    uttr.lang = "en-US";
    uttr.rate = 0.8;
    uttr.pitch = 1.1;
    const voices = window.speechSynthesis.getVoices();
    uttr.voice = voices.find(v => v.name.includes('Samantha') || v.name.includes('Google US English')) || voices[0];
    window.speechSynthesis.speak(uttr);
}

function shuffle(array) {
    for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
    }
    return array;
}

window.speechSynthesis.onvoiceschanged = () => {};
renderQuestion();
</script>

</body>
</html>
