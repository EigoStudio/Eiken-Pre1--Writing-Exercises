<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è‹±æ¤œæº–1ç´š ä½œæ–‡Exercise #2 (Convenience & Safety)</title>
    <link href="https://fonts.googleapis.com/css2?family=Kosugi+Maru&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Kosugi Maru', "Hiragino Maru Gothic ProN", sans-serif;
            background-color: #e0f2f1;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            padding-bottom: 100px; /* â‘¢å³ä¸‹ãƒœã‚¿ãƒ³ã¨ã®å¹²æ¸‰ã‚’é˜²ãä½™ç™½ */
            color: #004d40;
            margin: 0;
        }

        h2 { color: #00695c; margin-bottom: 5px; }
        .sub-title { font-size: 0.9rem; color: #00796b; margin-bottom: 20px; text-align: center; line-height: 1.4; }

        .container {
            background: white;
            max-width: 800px;
            width: 100%;
            padding: 25px;
            border-radius: 20px;
            box-shadow: 0 8px 20px rgba(0, 77, 64, 0.15);
            text-align: center;
            box-sizing: border-box;
        }

        .question-box {
            font-size: 1.1rem;
            font-weight: bold;
            margin-bottom: 20px;
            min-height: 60px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            background-color: #e8f5e9;
            border-radius: 15px;
            padding: 15px;
            border-left: 8px solid #4caf50;
            color: #1b5e20;
            text-align: left;
        }

        .answer-area {
            min-height: 80px;
            border: 2px dashed #80cbc4;
            margin-bottom: 20px;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 8px;
            padding: 15px;
            background-color: #fafafa;
            border-radius: 10px;
            transition: background-color 0.2s;
        }

        .final-sentence {
            font-size: 1.3rem;
            color: #004d40;
            font-weight: bold;
            padding: 20px;
            line-height: 1.6;
        }

        .word-bank { display: flex; flex-wrap: wrap; justify-content: center; gap: 10px; margin-bottom: 20px; }

        /* â‘ é¸æŠè‚¢ã®ãƒãƒ–ãƒ«ï¼šè‰²ã‚’è–„ãã€æ–‡å­—ã‚’æ¿ƒã */
        .word-btn {
            background-color: #b2dfdb; /* è–„ã„ã‚°ãƒªãƒ¼ãƒ³ */
            color: #004d40;           /* æ¿ƒã„æ–‡å­— */
            border: 2px solid #80cbc4;
            padding: 10px 16px;
            border-radius: 25px;
            font-size: 0.95rem;
            cursor: pointer;
            box-shadow: 0 3px 0 #80cbc4;
            font-weight: bold;
        }
        .word-btn.used { background-color: #e0e0e0; color: #bdbdbd; border-color: #d7d7d7; box-shadow: none; pointer-events: none; }

        .answer-word {
            background-color: #ffb300;
            color: #004d40;
            border: none;
            padding: 10px 16px;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer; /* ã‚¹ãƒãƒ›ãƒ»PCå…±é€š */
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            user-select: none;
            touch-action: manipulation;
        }

        .fab-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            display: flex;
            gap: 15px;
            z-index: 1000;
        }
        .fab {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: none;
            background-color: #ffb300;
            color: #004d40;
            font-size: 1.5rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }

        .result-msg { font-weight: bold; font-size: 1.2rem; min-height: 35px; margin-bottom: 10px; }

        @media print {
            body { background: white; padding: 0; color: black; }
            .no-print { display: none !important; }
            #printable-sheet { display: block !important; width: 100%; }
            .print-q-block { margin-bottom: 20px; page-break-inside: avoid; border-bottom: 1px solid #eee; padding-bottom: 10px; }
            .print-ja { font-weight: bold; font-size: 11pt; margin-bottom: 5px; }
            .print-words { font-style: italic; font-size: 10pt; color: #444; margin-bottom: 10px; }
            .print-line { border-bottom: 1px solid black; height: 30px; width: 95%; margin-top: 10px; }
            .answer-key { page-break-before: always; }
        }
        #printable-sheet { display: none; }
    </style>
</head>
<body>

<div class="no-print" style="text-align: center;">
    <h2>è‹±æ¤œæº–1ç´š ä½œæ–‡ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚° #2</h2>
    <div class="sub-title">Topic: Public Transportation Requirement<br><b>Focus: Convenience & Safety</b></div>
</div>

<div class="container no-print">
    <div id="game-ui">
        <div id="questionHeader" style="font-weight: bold; margin-bottom: 10px; color: #00796b;"></div>
        <div class="question-box" id="questionText"></div>
        <div class="result-msg" id="resultMsg"></div>
        <div class="answer-area" id="answerArea" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
        <div class="word-bank" id="wordBank"></div>
        <div style="margin-top: 20px; display: flex; justify-content: center; gap: 15px;">
            <button class="word-btn" id="checkBtn" onclick="checkAnswer()" style="background-color: #004d40; color: white; width: 180px; box-shadow: 0 3px 0 #002d20;">Check Answer</button>
            <button class="word-btn" id="nextBtn" onclick="nextQuestion()" style="display:none; background-color: #2e7d32; color: white; width: 180px; box-shadow: 0 3px 0 #1b5e20;">Next Question</button>
        </div>
    </div>
</div>

<div class="fab-container no-print">
    <button class="fab" id="ttsBtn" onclick="speakPhrase()" title="èª­ã¿ä¸Šã’" style="display:none;">ğŸ”Š</button>
    <button class="fab" onclick="window.print()" title="å°åˆ·">ğŸ–¨ï¸</button>
</div>

<div id="printable-sheet">
    <h1 style="text-align: center; border-bottom: 2px solid black;">è‹±æ¤œæº–1ç´š ä½œæ–‡æ¼”ç¿’ (Convenience & Safety)</h1>
    <div id="print-content"></div>
    <div class="answer-key">
        <h3>ã€è§£ç­” (Sample Answers)ã€‘</h3>
        <div id="print-answers"></div>
    </div>
</div>

<script>
let quizDataOriginal = [
    { ja: "[Convenience] è‡ªå®¶ç”¨è»Šã‚ˆã‚Šã‚‚å…¬å…±äº¤é€šã‚’å„ªå…ˆã™ã‚‹ã“ã¨ã¯ã€ã™ã¹ã¦ã®å¸‚æ°‘ã«å¯¾ã™ã‚‹ä¸å¯æ¬ ãªã‚µãƒ¼ãƒ“ã‚¹ã¸ã®ã‚ˆã‚Šå…¬å¹³ãªã‚¢ã‚¯ã‚»ã‚¹ã‚’ä¿è¨¼ã™ã‚‹ã€‚", en: "Prioritizing public transit over private cars ensures more equitable access to essential services for all citizens." },
    { ja: "[Convenience] ãƒã‚¹é‹è¡Œã¸ã®ã‚¹ãƒãƒ¼ãƒˆæŠ€è¡“ã®çµ±åˆã¯ã€éƒ½å¸‚ã®ç§»å‹•ã®å…¨ä½“çš„ãªåŠ¹ç‡ã‚’æœ€é©åŒ–ã™ã‚‹ã€‚", en: "The integration of smart technology into bus schedules optimizes the overall efficiency of urban movement." },
    { ja: "[Convenience] è‡ªå®¶ç”¨è»Šã®å°æ•°ã‚’æ¸›ã‚‰ã™ã“ã¨ã§ã€æ­©è¡Œè€…ã«å„ªã—ã„å…¬åœ’ã‚„å…¬å…±åºƒå ´ã®ãŸã‚ã®ã‚¹ãƒšãƒ¼ã‚¹ãŒå¢—ãˆã‚‹ã€‚", en: "Reducing the number of private vehicles creates more space for pedestrian-friendly parks and public plazas." },
    { ja: "[Convenience] æ•´å‚™ã•ã‚ŒãŸé‰„é“ã‚·ã‚¹ãƒ†ãƒ ã¯ã€æ•°åƒäººã®é€šå‹¤è€…ãŒæ¯æ—¥ã®äº¤é€šæ¸‹æ»ã§è²»ã‚„ã™æ™‚é–“ã®æµªè²»ã‚’æœ€å°é™ã«æŠ‘ãˆã‚‹ã€‚", en: "A well-organized rail system minimizes the time wasted by thousands of commuters in daily traffic jams." },
    { ja: "[Convenience] å…¬å…±äº¤é€šå¿—å‘å‹é–‹ç™ºã«ç„¦ç‚¹ã‚’å½“ã¦ãŸéƒ½å¸‚è¨ˆç”»ã¯ã€ã‚ˆã‚Šæ´»æ°—ã‚ã‚‹ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã‚’è‚²ã‚€ã€‚", en: "Urban planning focused on transit-oriented development fosters a more vibrant community." },
    { ja: "[Safety] è‡ªå®¶ç”¨è»Šã®äº¤é€šé‡ã‚’æ¸›ã‚‰ã™ã“ã¨ã¯ã€éƒ½å¸‚ã«ãŠã‘ã‚‹è‡´å‘½çš„ãªé“è·¯äº‹æ•…ã®é »åº¦ã‚’å¤§å¹…ã«æ¸›å°‘ã•ã›ã‚‹ã€‚", en: "Lowering the volume of private vehicle traffic significantly decreases the frequency of fatal road accidents in cities." },
    { ja: "[Safety] è»Šã®åˆ©ç”¨ã«å¯¾ã™ã‚‹å³æ ¼ãªè¦åˆ¶ã¯ã€å­ä¾›ã‚„é«˜é½¢è€…ã«ã¨ã£ã¦ã‚ˆã‚Šå®‰å…¨ãªç’°å¢ƒã®æ§‹ç¯‰ã«è²¢çŒ®ã™ã‚‹ã€‚", en: "Strict regulations on car usage contribute to the creation of safer environments for children and the elderly." },
    { ja: "[Safety] é©åˆ‡ã«ç›£è¦–ã•ã‚ŒãŸå…¬å…±äº¤é€šã¯ã€ä¸€äººæ­©ãã‚ˆã‚Šã‚‚å¤œé–“ã®ç§»å‹•ã«ãŠã„ã¦ã‚ˆã‚Šå®‰å…¨ãªé¸æŠè‚¢ã‚’æä¾›ã™ã‚‹ã€‚", en: "Public transit systems, when properly monitored, offer a more secure alternative for nighttime travel than walking alone." },
    { ja: "[Safety] äº¤é€šã«ã‚ˆã‚‹é¨’éŸ³å…¬å®³ã‚’æ¸›ã‚‰ã™ã“ã¨ã¯ã€éƒ½å¸‚å±…ä½è€…ã®ç²¾ç¥çš„å¥åº·ã¨ç”Ÿç”£æ€§ã‚’å‘ä¸Šã•ã›ã‚‹ã€‚", en: "Reducing noise pollution from heavy traffic improves the mental well-being and productivity of urban residents." },
    { ja: "[Safety] äº¤é€šæ‹ ç‚¹ã¾ã§æ­©ãã‚ˆã†ä¿ƒã™ã“ã¨ã¯ã€å¥åº·çš„ãªç”Ÿæ´»ã‚’ä¿ƒé€²ã—ã€ç”Ÿæ´»ç¿’æ…£ç—…ã®è”“å»¶ã‚’æŠ‘ãˆã‚‹ã€‚", en: "Encouraging people to walk to transit hubs promotes a healthier lifestyle, reducing the prevalence of lifestyle diseases." }
];

let quizData = [...quizDataOriginal];
let currentIdx = 0;
let userSelection = [];
let isCorrect = false;

function init() {
    renderQuestion();
    preparePrint();
}

function shuffle(array) {
    for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
    }
    return array;
}

function renderQuestion() {
    isCorrect = false;
    userSelection = [];
    document.getElementById('ttsBtn').style.display = 'none';
    document.getElementById('nextBtn').style.display = 'none';
    document.getElementById('checkBtn').style.display = 'block';
    document.getElementById('resultMsg').textContent = "";
    document.getElementById('questionHeader').textContent = `Question ${currentIdx + 1} / ${quizData.length}`;
    const q = quizData[currentIdx];
    document.getElementById('questionText').innerHTML = q.ja;

    let words = q.en.replace(/([.,])/g, " $1").split(/\s+/).filter(w => w.length > 0);
    let shuffled = shuffle([...words]);

    const bank = document.getElementById('wordBank');
    bank.innerHTML = "";
    shuffled.forEach((w, i) => {
        const btn = document.createElement('button');
        btn.className = "word-btn";
        btn.textContent = w;
        btn.onclick = () => addWord(w, btn);
        bank.appendChild(btn);
    });
    renderAnswer();
}

function addWord(word, btn) {
    userSelection.push({ text: word, btn: btn });
    btn.classList.add('used');
    renderAnswer();
}

function renderAnswer() {
    const area = document.getElementById('answerArea');
    area.innerHTML = "";
    if (userSelection.length === 0 && !isCorrect) {
        area.innerHTML = '<span style="color:#aaa; font-size:0.85rem;">ã‚¿ãƒƒãƒ—ã§è¿½åŠ  / é…ç½®å¾Œã‚‚ãƒ‰ãƒ©ãƒƒã‚°ã‚„ã‚¿ãƒƒãƒ—ã§é †åºå¤‰æ›´å¯èƒ½</span>';
    }
    userSelection.forEach((obj, i) => {
        const btn = document.createElement('button');
        btn.className = "answer-word";
        btn.textContent = obj.text;
        btn.draggable = true;
        
        // PCç”¨ãƒ‰ãƒ©ãƒƒã‚°é–‹å§‹
        btn.ondragstart = (e) => {
            e.dataTransfer.setData("text/plain", i);
            btn.style.opacity = "0.5";
        };
        btn.ondragend = () => { btn.style.opacity = "1"; };

        // ã‚¹ãƒãƒ›ç”¨ç°¡æ˜“å…¥ã‚Œæ›¿ãˆï¼šã‚¿ãƒƒãƒ—ã§ä¸€ã¤å‰ã«ç§»å‹•ï¼ˆé€£ç¶šã‚¿ãƒƒãƒ—ã§å¥½ããªä½ç½®ã¸ï¼‰
        btn.onclick = () => {
            if (i > 0) {
                const item = userSelection.splice(i, 1)[0];
                userSelection.splice(i - 1, 0, item);
                renderAnswer();
            } else {
                // å…ˆé ­ã§ã‚¿ãƒƒãƒ—ã—ãŸã‚‰å‰Šé™¤ã—ã¦Word Bankã«æˆ»ã™
                removeWord(i);
            }
        };
        area.appendChild(btn);
    });
}

function allowDrop(e) { e.preventDefault(); }
function drop(e) {
    e.preventDefault();
    const fromIdx = e.dataTransfer.getData("text/plain");
    const target = e.target;
    if (target.className === "answer-word") {
        const toIdx = Array.from(target.parentNode.children).indexOf(target);
        const item = userSelection.splice(fromIdx, 1)[0];
        userSelection.splice(toIdx, 0, item);
        renderAnswer();
    }
}

function removeWord(i) {
    userSelection[i].btn.classList.remove('used');
    userSelection.splice(i, 1);
    renderAnswer();
}

function checkAnswer() {
    const userStr = userSelection.map(o => o.text).join(" ").replace(/\s+([.,])/g, "$1");
    const q = quizData[currentIdx];
    if (userStr === q.en) {
        isCorrect = true;
        document.getElementById('resultMsg').innerHTML = "<span style='color:#2e7d32;'>Excellent! ç¤¾ä¼šçš„ãªè¦–ç‚¹ã§ã®è¨˜è¿°ãŒå®Œç’§ã§ã™ã€‚</span>";
        document.getElementById('answerArea').innerHTML = `<div class="final-sentence" id="orderPhrase">${userStr}</div>`;
        document.getElementById('wordBank').innerHTML = "";
        document.getElementById('ttsBtn').style.display = 'flex';
        document.getElementById('checkBtn').style.display = 'none';
        document.getElementById('nextBtn').style.display = 'block';
    } else {
        document.getElementById('resultMsg').innerHTML = "<span style='color:#c62828;'>æƒœã—ã„ï¼åºƒã„è¦–ç‚¹ã§ã®æ–‡æ§‹é€ ã‚’æ„è­˜ã—ã¾ã—ã‚‡ã†ã€‚</span>";
    }
}

function speak(text) {
    const synth = window.speechSynthesis;
    synth.cancel(); 
    const uttr = new SpeechSynthesisUtterance(text);
    uttr.lang = "en-US";
    uttr.rate = 0.8; 
    uttr.pitch = 1.1; 
    const voices = synth.getVoices();
    const targetVoice = 
        voices.find(v => v.name.includes('Samantha')) ||        
        voices.find(v => v.name.includes('Google US English')) || 
        voices.find(v => v.name.includes('Zira')) ||            
        voices.find(v => v.lang === 'en-US') ||
        voices.find(v => v.lang.startsWith('en'));
    if (targetVoice) { uttr.voice = targetVoice; }
    synth.speak(uttr);
}

function speakPhrase() {
    const phrase = document.getElementById('orderPhrase').innerText;
    speak(phrase);
}

function nextQuestion() {
    currentIdx++;
    if (currentIdx < quizData.length) renderQuestion();
    else {
        document.getElementById('game-ui').innerHTML = "<h2 style='color:#2e7d32;'>ğŸ‰ All Tasks Completed!</h2><p>é«˜åº¦ãªç¤¾ä¼šè¦–ç‚¹ãƒ•ãƒ¬ãƒ¼ã‚ºã‚’å…¨ã¦ãƒã‚¹ã‚¿ãƒ¼ã—ã¾ã—ãŸï¼</p>";
    }
}

function preparePrint() {
    const container = document.getElementById('print-content');
    const keyContainer = document.getElementById('print-answers');
    container.innerHTML = ""; keyContainer.innerHTML = "";
    quizDataOriginal.forEach((q, i) => {
        let words = shuffle(q.en.replace(/([.,])/g, " $1").split(/\s+/).filter(w => w.length > 0));
        container.innerHTML += `<div class="print-q-block"><div class="print-ja">${i+1}. ${q.ja}</div><div class="print-words">(${words.join(" / ")})</div><div class="print-line"></div></div>`;
        keyContainer.innerHTML += `<div>${i+1}. ${q.en}</div>`;
    });
}
window.speechSynthesis.onvoiceschanged = () => {};
init();
</script>
</body>
</html>
