<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>2025-2 Ëã±Ê§úÊ∫ñ1Á¥ö ‰ΩúÊñá ‰∏¶„ÅπÊõø„Åà Part2</title>
    <link href="https://fonts.googleapis.com/css2?family=Kosugi+Maru&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Kosugi Maru', sans-serif;
            background-color: #e0f2f1;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px;
            padding-bottom: 100px;
            color: #004d40;
            margin: 0;
            overflow-x: hidden;
            touch-action: pan-y;
        }

        h2 { color: #00695c; margin-top: 15px; margin-bottom: 5px; font-size: 1.6rem; }
        .sub-title { font-size: 0.9rem; color: #00796b; margin-bottom: 20px; text-align: center; }

        .container {
            background: white;
            width: 100%;
            max-width: 900px;
            padding: 20px;
            border-radius: 20px;
            box-shadow: 0 8px 25px rgba(0, 77, 64, 0.1);
            text-align: center;
            box-sizing: border-box;
        }

        .question-box {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 20px;
            background-color: #e8f5e9;
            border-radius: 15px;
            padding: 18px;
            border-left: 8px solid #4caf50;
            text-align: left;
            line-height: 1.6;
        }

        .answer-area {
            min-height: 110px;
            border: 3px dashed #80cbc4;
            margin-bottom: 20px;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            padding: 15px;
            background-color: #fafafa;
            border-radius: 12px;
        }

        .word-bank { 
            display: flex; 
            flex-wrap: wrap; 
            justify-content: center; 
            gap: 12px; 
            margin-bottom: 20px;
        }

        .word-btn {
            background-color: #b2dfdb; 
            color: #004d40;           
            border: 2px solid #80cbc4;
            padding: 12px 20px;
            border-radius: 30px;
            font-size: 1.1rem;
            font-weight: bold;
            box-shadow: 0 4px 0 #80cbc4;
            cursor: pointer;
        }
        .word-btn.used { background-color: #e0e0e0; color: #bdbdbd !important; border-color: #d7d7d7; box-shadow: none; pointer-events: none; }

        .answer-word {
            background-color: #ffb300;
            color: #004d40;
            padding: 12px 20px;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: bold;
            box-shadow: 0 4px 6px rgba(0,0,0,0.15);
            user-select: none;
            touch-action: none;
            cursor: move;
        }

        .dragging { opacity: 0.4; transform: scale(1.05); outline: 2px solid #004d40; z-index: 1000; pointer-events: none; }

        .fab-container { position: fixed; bottom: 30px; right: 30px; z-index: 2000; display: flex; flex-direction: column; gap: 15px; }
        .fab { width: 65px; height: 65px; border-radius: 50%; border: none; background-color: #ffb300; color: #004d40; font-size: 1.8rem; box-shadow: 0 6px 15px rgba(0,0,0,0.3); cursor: pointer; display: flex; align-items: center; justify-content: center; }

        .result-msg { font-weight: bold; margin-bottom: 15px; min-height: 30px; font-size: 1.2rem; }
        .final-sentence { font-size: 1.5rem; font-weight: bold; padding: 25px; line-height: 1.6; color: #004d40; }

        @media screen and (max-width: 600px) {
            h2 { font-size: 1.3rem; }
            .question-box { font-size: 1rem; padding: 12px; }
            .word-btn, .answer-word { font-size: 0.95rem; padding: 8px 14px; }
            .container { padding: 10px; }
            .answer-area { min-height: 90px; gap: 6px; }
        }

        /* --- Âç∞Âà∑Áî®Ë®≠ÂÆöÔºàPart1Ê∫ñÊã† + „Çø„Ç§„Éà„É´Â∞èÔºâ --- */
        #printable-sheet { display: none; }
        @media print {
            .no-print { display: none !important; }
            body { background: white !important; padding: 0; font-family: 'Kosugi Maru', sans-serif; }
            #printable-sheet { display: block !important; width: 100%; color: black; background: white; }
            /* „Çø„Ç§„Éà„É´„ÅÆ„Éï„Ç©„É≥„Éà„Çµ„Ç§„Ç∫„ÇíÂ∞è„Åï„ÇÅ„Å´Ë®≠ÂÆö */
            .print-header h1 { font-size: 16pt; text-align: center; border-bottom: 2px solid black; padding-bottom: 5px; margin-bottom: 20px; }
            .print-q-block { margin-bottom: 25px; border-bottom: 1px solid #ccc; padding-bottom: 10px; page-break-inside: avoid; }
            .print-ja { font-weight: bold; font-size: 11pt; margin-bottom: 5px; }
            .print-words { font-style: italic; margin-bottom: 10px; font-size: 0.9rem; color: #333; }
            .print-line { border-bottom: 1px solid black; height: 30px; width: 100%; margin-top: 10px; }
            .answer-key h2 { font-size: 14pt; margin-top: 30px; border-top: 2px solid black; padding-top: 10px; }
        }
    </style>
</head>
<body>

<div class="no-print" style="text-align: center;">
    <h2>Ëã±Ê§úÊ∫ñ1Á¥ö ‰ΩúÊñá ‰∏¶„ÅπÊõø„Åà Part2</h2>
    <div class="sub-title">Convenience & Safety</div>
</div>

<div class="container no-print">
    <div id="game-ui">
        <div id="questionHeader" style="font-weight: bold; margin-bottom: 10px; font-size: 1rem;"></div>
        <div class="question-box" id="questionText"></div>
        <div class="result-msg" id="resultMsg"></div>
        <div class="answer-area" id="answerArea"></div>
        <div class="word-bank" id="wordBank"></div>
        <div style="margin-top: 20px; display: flex; justify-content: center; gap: 15px;">
            <button class="word-btn" id="checkBtn" onclick="checkAnswer()" style="background-color: #004d40; color: white; min-width: 200px;">Check Answer</button>
            <button class="word-btn" id="nextBtn" onclick="nextQuestion()" style="display:none; background-color: #2e7d32; color: white; min-width: 200px;">Next Question</button>
        </div>
        
        <div class="footer-tools no-print" style="margin-top: 30px;">
            <button class="word-btn" onclick="window.print()" style="background-color: #607d8b; color: white; font-size: 0.8rem; padding: 8px 15px;">üñ®Ô∏è Âç∞Âà∑Áî®„Éö„Éº„Ç∏„ÇíË°®Á§∫</button>
        </div>
    </div>
</div>

<div class="fab-container no-print">
    <button class="fab" id="ttsBtn" onclick="speakPhrase()" style="display:none;">üîä</button>
</div>

<div id="printable-sheet">
    <div class="print-header">
        <h1>Ëã±Ê§úÊ∫ñ1Á¥ö Ëã±‰ΩúÊñá„Éà„É¨„Éº„Éã„É≥„Ç∞ (Part 2)</h1>
    </div>
    <div id="print-content"></div>
    <div class="answer-key" style="page-break-before: always;">
        <h2>„ÄêËß£Á≠î (Answer Key)„Äë</h2>
        <div id="print-answers"></div>
    </div>
</div>

<script>
const quizData = [
    { ja: "[Convenience] Ëá™ÂÆ∂Áî®Ëªä„Çà„Çä„ÇÇÂÖ¨ÂÖ±‰∫§ÈÄö„ÇíÂÑ™ÂÖà„Åô„Çã„Åì„Å®„ÅØ„ÄÅ„Åô„Åπ„Å¶„ÅÆÂ∏ÇÊ∞ë„Å´ÂØæ„Åô„Çã‰∏çÂèØÊ¨†„Å™„Çµ„Éº„Éì„Çπ„Å∏„ÅÆ„Çà„ÇäÂÖ¨Âπ≥„Å™„Ç¢„ÇØ„Çª„Çπ„Çí‰øùË®º„Åô„Çã„ÄÇ", en: "Prioritizing public transit over private cars ensures more equitable access to essential services for all citizens." },
    { ja: "[Convenience] „Éê„ÇπÈÅãË°å„Å∏„ÅÆ„Çπ„Éû„Éº„ÉàÊäÄË°ì„ÅÆÁµ±Âêà„ÅØ„ÄÅÈÉΩÂ∏Ç„ÅÆÁßªÂãï„ÅÆÂÖ®‰ΩìÁöÑ„Å™ÂäπÁéá„ÇíÊúÄÈÅ©Âåñ„Åô„Çã„ÄÇ", en: "The integration of smart technology into bus schedules optimizes the overall efficiency of urban movement." },
    { ja: "[Convenience] Ëá™ÂÆ∂Áî®Ëªä„ÅÆÂè∞Êï∞„ÇíÊ∏õ„Çâ„Åô„Åì„Å®„Åß„ÄÅÊ≠©Ë°åËÄÖ„Å´ÂÑ™„Åó„ÅÑÂÖ¨Âúí„ÇÑÂÖ¨ÂÖ±Â∫ÉÂ†¥„ÅÆ„Åü„ÇÅ„ÅÆ„Çπ„Éö„Éº„Çπ„ÅåÂ¢ó„Åà„Çã„ÄÇ", en: "Reducing the number of private vehicles creates more space for pedestrian-friendly parks and public plazas." },
    { ja: "[Convenience] Êï¥ÂÇô„Åï„Çå„ÅüÈâÑÈÅì„Ç∑„Çπ„ÉÜ„É†„ÅØ„ÄÅÊï∞ÂçÉ‰∫∫„ÅÆÈÄöÂã§ËÄÖ„ÅåÊØéÊó•„ÅÆ‰∫§ÈÄöÊ∏ãÊªû„ÅßË≤ª„ÇÑ„ÅôÊôÇÈñì„ÅÆÊµ™Ë≤ª„ÇíÊúÄÂ∞èÈôê„Å´Êäë„Åà„Çã„ÄÇ", en: "A well-organized rail system minimizes the time wasted by thousands of commuters in daily traffic jams." },
    { ja: "[Convenience] ÂÖ¨ÂÖ±‰∫§ÈÄöÂøóÂêëÂûãÈñãÁô∫„Å´ÁÑ¶ÁÇπ„ÇíÂΩì„Å¶„ÅüÈÉΩÂ∏ÇË®àÁîª„ÅØ„ÄÅ„Çà„ÇäÊ¥ªÊ∞ó„ÅÇ„Çã„Ç≥„Éü„É•„Éã„ÉÜ„Ç£„ÇíËÇ≤„ÇÄ„ÄÇ", en: "Urban planning focused on transit-oriented development fosters a more vibrant community." },
    { ja: "[Safety] Ëá™ÂÆ∂Áî®Ëªä„ÅÆ‰∫§ÈÄöÈáè„ÇíÊ∏õ„Çâ„Åô„Åì„Å®„ÅØ„ÄÅÈÉΩÂ∏Ç„Å´„Åä„Åë„ÇãËá¥ÂëΩÁöÑ„Å™ÈÅìË∑Ø‰∫ãÊïÖ„ÅÆÈ†ªÂ∫¶„ÇíÂ§ßÂπÖ„Å´Ê∏õÂ∞ë„Åï„Åõ„Çã„ÄÇ", en: "Lowering the volume of private vehicle traffic significantly decreases the frequency of fatal road accidents in cities." },
    { ja: "[Safety] Ëªä„ÅÆÂà©Áî®„Å´ÂØæ„Åô„ÇãÂé≥Ê†º„Å™Ë¶èÂà∂„ÅØ„ÄÅÂ≠ê‰æõ„ÇÑÈ´òÈΩ¢ËÄÖ„Å´„Å®„Å£„Å¶„Çà„ÇäÂÆâÂÖ®„Å™Áí∞Â¢É„ÅÆÊßãÁØâ„Å´Ë≤¢ÁåÆ„Åô„Çã„ÄÇ", en: "Strict regulations on car usage contribute to the creation of safer environments for children and the elderly." },
    { ja: "[Safety] ÈÅ©Âàá„Å´Áõ£Ë¶ñ„Åï„Çå„ÅüÂÖ¨ÂÖ±‰∫§ÈÄö„ÅØ„ÄÅ‰∏Ä‰∫∫Ê≠©„Åç„Çà„Çä„ÇÇÂ§úÈñì„ÅÆÁßªÂãï„Å´„Åä„ÅÑ„Å¶„Çà„ÇäÂÆâÂÖ®„Å™ÈÅ∏ÊäûËÇ¢„ÇíÊèê‰æõ„Åô„Çã„ÄÇ", en: "Public transit systems, when properly monitored, offer a more secure alternative for nighttime travel than walking alone." },
    { ja: "[Safety] ‰∫§ÈÄö„Å´„Çà„ÇãÈ®íÈü≥ÂÖ¨ÂÆ≥„ÇíÊ∏õ„Çâ„Åô„Åì„Å®„ÅØ„ÄÅÈÉΩÂ∏ÇÂ±Ö‰ΩèËÄÖ„ÅÆÁ≤æÁ•ûÁöÑÂÅ•Â∫∑„Å®ÁîüÁî£ÊÄß„ÇíÂêë‰∏ä„Åï„Åõ„Çã„ÄÇ", en: "Reducing noise pollution from heavy traffic improves the mental well-being and productivity of urban residents." },
    { ja: "[Safety] ‰∫§ÈÄöÊã†ÁÇπ„Åæ„ÅßÊ≠©„Åè„Çà„ÅÜ‰øÉ„Åô„Åì„Å®„ÅØ„ÄÅÂÅ•Â∫∑ÁöÑ„Å™ÁîüÊ¥ª„Çí‰øÉÈÄ≤„Åó„ÄÅÁîüÊ¥ªÁøíÊÖ£ÁóÖ„ÅÆËîìÂª∂„ÇíÊäë„Åà„Çã„ÄÇ", en: "Encouraging people to walk to transit hubs promotes a healthier lifestyle, reducing the prevalence of lifestyle diseases." }
];

let currentIdx = 0;
let userSelection = [];
let dragItem = null;
let isSpeaking = false;

function preparePrint() {
    const content = document.getElementById('print-content');
    const answers = document.getElementById('print-answers');
    content.innerHTML = ""; answers.innerHTML = "";
    quizData.forEach((q, i) => {
        let words = shuffle([...q.en.replace(/([.,])/g, " $1").split(/\s+/).filter(w => w.length > 0)]);
        content.innerHTML += `<div class="print-q-block"><div class="print-ja">${i+1}. ${q.ja}</div><div class="print-words">(${words.join(" / ")})</div><div class="print-line"></div></div>`;
        answers.innerHTML += `<div>${i+1}. ${q.en}</div>`;
    });
}

function renderQuestion() {
    userSelection = [];
    document.getElementById('resultMsg').textContent = "";
    document.getElementById('nextBtn').style.display = "none";
    document.getElementById('checkBtn').style.display = "block";
    document.getElementById('ttsBtn').style.display = "none";
    document.getElementById('questionHeader').textContent = `Question ${currentIdx + 1} / ${quizData.length}`;
    document.getElementById('questionText').textContent = quizData[currentIdx].ja;

    let words = quizData[currentIdx].en.replace(/([.,])/g, " $1").split(/\s+/).filter(w => w.length > 0);
    const bank = document.getElementById('wordBank');
    bank.innerHTML = "";
    shuffle(words).forEach(w => {
        const btn = document.createElement('button');
        btn.className = "word-btn";
        btn.textContent = w;
        btn.onclick = () => {
            if (!btn.classList.contains('used')) {
                btn.classList.add('used');
                userSelection.push({ text: w, btn: btn });
                renderAnswer();
            }
        };
        bank.appendChild(btn);
    });
    renderAnswer();
}

function renderAnswer() {
    const area = document.getElementById('answerArea');
    area.innerHTML = userSelection.length === 0 ? '<span style="color:#aaa; font-size:0.9rem;">„Çø„ÉÉ„Éó„ÅßËøΩÂä† / Èï∑Êäº„Åó„Çπ„É©„Ç§„Éâ„Åß‰∏¶„ÅπÊõø„Åà</span>' : "";

    userSelection.forEach((obj, i) => {
        const span = document.createElement('div');
        span.className = "answer-word";
        if (i === dragItem) span.classList.add('dragging');
        span.textContent = obj.text;
        
        let moved = false;
        let startX, startY;

        span.onpointerdown = (e) => {
            moved = false;
            startX = e.clientX;
            startY = e.clientY;
            dragItem = i; 
            span.setPointerCapture(e.pointerId);
            renderAnswer(); 
        };

        span.onpointermove = (e) => {
            if (dragItem === null || dragItem !== i) return; 
            if (Math.abs(e.clientX - startX) > 5 || Math.abs(e.clientY - startY) > 5) {
                moved = true;
                const target = document.elementFromPoint(e.clientX, e.clientY);
                if (target && target.classList.contains('answer-word')) {
                    const targetIdx = Array.from(area.children).indexOf(target);
                    if (targetIdx !== dragItem && targetIdx !== -1) {
                        const temp = userSelection.splice(dragItem, 1)[0];
                        userSelection.splice(targetIdx, 0, temp);
                        dragItem = targetIdx;
                        renderAnswer();
                    }
                }
            }
        };

        span.onpointerup = (e) => {
            if (dragItem === null || dragItem !== i) return;
            span.releasePointerCapture(e.pointerId);
            const wasActuallyDragging = moved;
            dragItem = null;
            if (!wasActuallyDragging) {
                obj.btn.classList.remove('used');
                userSelection.splice(i, 1);
            }
            renderAnswer();
        };
        area.appendChild(span);
    });
}

function checkAnswer() {
    const userStr = userSelection.map(o => o.text).join(" ").replace(/\s+([.,])/g, "$1");
    if (userStr === quizData[currentIdx].en) {
        document.getElementById('resultMsg').innerHTML = "<span style='color:green; font-weight:bold;'>Excellent! Ê≠£Ëß£„Åß„Åô„ÄÇ</span>";
        document.getElementById('answerArea').innerHTML = `<div class="final-sentence" id="orderPhrase">${userStr}</div>`;
        document.getElementById('wordBank').innerHTML = "";
        document.getElementById('checkBtn').style.display = "none";
        document.getElementById('nextBtn').style.display = "block";
        document.getElementById('ttsBtn').style.display = "flex";
        document.getElementById('ttsBtn').textContent = "üîä";
    } else {
        document.getElementById('resultMsg').innerHTML = "<span style='color:red;'>Try again! Ë™ûÈ†Ü„ÇíÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ</span>";
    }
}

function speakPhrase() {
    const synth = window.speechSynthesis;
    if (synth.speaking && isSpeaking) { synth.cancel(); return; }
    synth.cancel();
    const uttr = new SpeechSynthesisUtterance(document.getElementById('orderPhrase').innerText);
    uttr.lang = "en-US";
    uttr.rate = 0.8;
    uttr.pitch = 1.0; 
    const voices = synth.getVoices();
    const targetVoice = voices.find(v => v.name === 'Google US English') || voices.find(v => v.name === 'Samantha') || voices[0];
    if (targetVoice) uttr.voice = targetVoice;
    uttr.onstart = () => { isSpeaking = true; document.getElementById('ttsBtn').textContent = "‚èπÔ∏è"; };
    uttr.onend = () => { isSpeaking = false; document.getElementById('ttsBtn').textContent = "üîä"; };
    synth.speak(uttr);
}

function nextQuestion() {
    currentIdx++;
    if (currentIdx < quizData.length) renderQuestion();
    else document.getElementById('game-ui').innerHTML = "<h2 style='color:#00695c;'>üéâ Part 2 Complete!</h2>";
}

function shuffle(array) {
    const n = [...array];
    for (let i = n.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [n[i], n[j]] = [n[j], n[i]];
    }
    return n;
}

window.speechSynthesis.onvoiceschanged = () => {};
preparePrint();
renderQuestion();
</script>
</body>
</html>
